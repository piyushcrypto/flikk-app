<!-- Edit Creator Profile -->
<style>
  .dashboard-bg { background: #0a0a0a; }
  .card-bg { background: #1a1a1a; }
</style>

<div class="min-h-screen dashboard-bg py-8 px-4">
  <div class="max-w-2xl mx-auto">
    
    <!-- Back Button -->
    <%= link_to creator_profile_path, class: "inline-flex items-center space-x-2 text-gray-400 hover:text-white transition-colors mb-6" do %>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      <span>Back to Profile</span>
    <% end %>

    <div class="card-bg rounded-2xl p-8 border border-gray-800">
      <h1 class="text-2xl font-bold text-white mb-6">Edit Profile</h1>

      <%= form_with model: @creator, url: creator_profile_path, method: :patch, html: { multipart: true }, class: "space-y-6" do |f| %>
        
        <% if @creator.errors.any? %>
          <div class="bg-red-500/20 border border-red-500 rounded-xl p-4">
            <ul class="list-disc list-inside text-red-400 text-sm">
              <% @creator.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <!-- Avatar Upload -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-3">Profile Picture</label>
          <div class="flex items-center space-x-6">
            <div id="avatar-preview" class="w-24 h-24 rounded-full overflow-hidden border-2 border-gray-700">
              <% if @creator.avatar.attached? %>
                <%= image_tag @creator.avatar, class: "w-full h-full object-cover" %>
              <% else %>
                <div class="w-full h-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center">
                  <span class="text-white font-bold text-2xl"><%= @creator.name.first.upcase %></span>
                </div>
              <% end %>
            </div>
            <label class="cursor-pointer">
              <div class="px-4 py-2 bg-[#252525] hover:bg-[#333] text-white rounded-lg transition-colors">
                Change Photo
              </div>
              <%= f.file_field :avatar, accept: "image/*", class: "hidden", onchange: "previewAvatar(this)" %>
            </label>
          </div>
        </div>

        <!-- Cover Image Upload -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-3">Cover Image</label>
          <div id="cover-preview" class="relative h-32 rounded-xl overflow-hidden border-2 border-gray-700 mb-3">
            <% if @creator.cover_image.attached? %>
              <%= image_tag @creator.cover_image, class: "w-full h-full object-cover" %>
            <% else %>
              <div class="w-full h-full bg-gradient-to-br from-pink-500/30 to-purple-600/30 flex items-center justify-center">
                <span class="text-gray-500">No cover image</span>
              </div>
            <% end %>
          </div>
          <label class="cursor-pointer inline-block">
            <div class="px-4 py-2 bg-[#252525] hover:bg-[#333] text-white rounded-lg transition-colors">
              Change Cover
            </div>
            <%= f.file_field :cover_image, accept: "image/*", class: "hidden", onchange: "previewCover(this)" %>
          </label>
        </div>

        <!-- Name -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Display Name</label>
          <%= f.text_field :name, class: "w-full bg-[#0a0a0a] border border-gray-700 rounded-xl py-3 px-4 text-white placeholder-gray-600 focus:outline-none focus:border-pink-500 transition-colors" %>
        </div>

        <!-- Username -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Username</label>
          <div class="relative">
            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">@</span>
            <%= f.text_field :username, class: "w-full bg-[#0a0a0a] border border-gray-700 rounded-xl py-3 pl-10 pr-4 text-white placeholder-gray-600 focus:outline-none focus:border-pink-500 transition-colors" %>
          </div>
        </div>

        <!-- Instagram Handle -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Instagram Handle</label>
          <div class="relative">
            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">@</span>
            <%= f.text_field :instagram_handle, class: "w-full bg-[#0a0a0a] border border-gray-700 rounded-xl py-3 pl-10 pr-4 text-white placeholder-gray-600 focus:outline-none focus:border-pink-500 transition-colors" %>
          </div>
        </div>

        <!-- Category -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Category</label>
          <%= f.select :category, 
              options_for_select([
                ['Lifestyle', 'Lifestyle'],
                ['Fitness', 'Fitness'],
                ['Music', 'Music'],
                ['Comedy', 'Comedy'],
                ['Fashion', 'Fashion'],
                ['Beauty', 'Beauty'],
                ['Gaming', 'Gaming'],
                ['Food', 'Food'],
                ['Travel', 'Travel'],
                ['Tech', 'Tech'],
                ['Business', 'Business'],
                ['Entertainment', 'Entertainment'],
                ['Wellness', 'Wellness'],
                ['Dance', 'Dance'],
                ['Art', 'Art'],
                ['Other', 'Other']
              ], @creator.category),
              { prompt: 'Select a category' },
              class: "w-full bg-[#0a0a0a] border border-gray-700 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-pink-500 transition-colors" %>
        </div>

        <!-- Bio -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Bio</label>
          <%= f.text_area :bio, rows: 4, maxlength: 500, placeholder: "Tell your fans about yourself...", class: "w-full bg-[#0a0a0a] border border-gray-700 rounded-xl py-3 px-4 text-white placeholder-gray-600 focus:outline-none focus:border-pink-500 transition-colors resize-none" %>
          <p class="text-xs text-gray-500 mt-1 text-right"><span id="bio-count"><%= @creator.bio&.length || 0 %></span>/500</p>
        </div>

        <!-- Submit -->
        <div class="flex items-center space-x-4">
          <%= f.submit "Save Changes", class: "flex-1 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold rounded-xl hover:opacity-90 transition-opacity cursor-pointer" %>
          <%= link_to "Cancel", creator_profile_path, class: "px-6 py-3 bg-[#252525] text-white rounded-xl hover:bg-[#333] transition-colors text-center" %>
        </div>
      <% end %>
    </div>

  </div>
</div>

<script>
function previewAvatar(input) {
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('avatar-preview').innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover" alt="Preview">`;
    };
    reader.readAsDataURL(input.files[0]);
  }
}

function previewCover(input) {
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('cover-preview').innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover" alt="Preview">`;
    };
    reader.readAsDataURL(input.files[0]);
  }
}

document.addEventListener('turbo:load', () => {
  const bioTextarea = document.querySelector('textarea[name="user[bio]"]');
  const bioCount = document.getElementById('bio-count');
  
  if (bioTextarea && bioCount) {
    bioTextarea.addEventListener('input', () => {
      bioCount.textContent = bioTextarea.value.length;
    });
  }
});
</script>

