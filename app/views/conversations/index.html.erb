<!-- Messages Page -->
<style>
  .dashboard-bg { background: #0a0a0a; }
  .card-bg { background: #1a1a1a; }
  .message-input:focus { outline: none; }
  
  @keyframes online-pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
    50% { box-shadow: 0 0 0 4px rgba(34, 197, 94, 0); }
  }
  .online-ring { animation: online-pulse 2s infinite; }

  .conversation-item:hover { background: #252525; }
  .conversation-item.active { background: #252525; border-left: 3px solid #ec4899; }
</style>

<!-- Navbar -->
<nav class="fixed top-0 left-0 right-0 z-50 dashboard-bg border-b border-gray-800 h-16">
  <div class="max-w-7xl mx-auto px-4 h-full flex items-center justify-between">
    <div class="flex items-center">
      <%= link_to dashboard_path, class: "flex items-center space-x-2" do %>
        <%= render 'shared/logo_icon', size: 'sm' %>
        <span class="logo-text text-xl sm:text-2xl bg-gradient-to-r from-pink-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">flik<span class="mirror-k" style="background: inherit; -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">k</span></span>
      <% end %>
    </div>

    <div class="flex items-center space-x-4">
      <%= link_to dashboard_path, class: "text-gray-400 hover:text-white transition-colors" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
      <% end %>
      
      <div class="relative" id="user-menu-container">
        <button id="user-menu-btn" class="flex items-center space-x-2 focus:outline-none">
          <div class="w-9 h-9 rounded-full overflow-hidden border-2 border-gray-700 hover:border-pink-500 transition-colors">
            <% if current_user.avatar.attached? %>
              <%= image_tag current_user.avatar, class: "w-full h-full object-cover" %>
            <% else %>
              <div class="w-full h-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center">
                <span class="text-white font-bold text-sm"><%= current_user.name.first.upcase %></span>
              </div>
            <% end %>
          </div>
        </button>
        <div id="user-menu-dropdown" class="absolute right-0 mt-2 w-48 card-bg rounded-xl shadow-2xl border border-gray-800 py-2 hidden">
          <%= button_to destroy_user_session_path, method: :delete, class: "block w-full text-left px-4 py-2.5 text-sm text-red-400 hover:bg-red-500/10 transition-colors" do %>
            Log out
          <% end %>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="pt-16 min-h-screen dashboard-bg text-white">
  <div class="flex h-[calc(100vh-4rem)]">
    
    <!-- Conversations List -->
    <div class="w-full md:w-80 lg:w-96 border-r border-gray-800 flex flex-col" id="conversations-list">
      <div class="p-4 border-b border-gray-800">
        <h1 class="text-xl font-bold">Messages</h1>
        <p class="text-sm text-gray-400"><%= @conversations.count %> conversations</p>
      </div>
      
      <div class="flex-1 overflow-y-auto">
        <% if @conversations.any? %>
          <% @conversations.each do |conversation| %>
            <% other = conversation.other_participant(current_user) %>
            <%= link_to conversation_path(conversation), 
                class: "conversation-item block p-4 border-b border-gray-800 transition-colors",
                data: { conversation_id: conversation.id } do %>
              <div class="flex items-center space-x-3">
                <div class="relative flex-shrink-0">
                  <div class="w-12 h-12 rounded-full overflow-hidden <%= other.is_live? ? 'online-ring' : '' %>">
                    <% if other.avatar.attached? %>
                      <%= image_tag other.avatar, class: "w-full h-full object-cover" %>
                    <% else %>
                      <div class="w-full h-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center">
                        <span class="text-white font-bold"><%= other.name.first.upcase %></span>
                      </div>
                    <% end %>
                  </div>
                  <% if other.is_live? %>
                    <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-[#1a1a1a] rounded-full"></div>
                  <% end %>
                </div>
                
                <div class="flex-1 min-w-0">
                  <div class="flex items-center justify-between">
                    <h3 class="font-bold text-white truncate"><%= other.name %></h3>
                    <% if conversation.last_message_at %>
                      <span class="text-xs text-gray-500"><%= time_ago_in_words(conversation.last_message_at) %></span>
                    <% end %>
                  </div>
                  <div class="flex items-center justify-between">
                    <p class="text-sm text-gray-400 truncate"><%= conversation.last_message_preview || "No messages yet" %></p>
                    <% if conversation.unread_count_for(current_user) > 0 %>
                      <span class="ml-2 px-2 py-0.5 bg-pink-500 text-white text-xs font-bold rounded-full">
                        <%= conversation.unread_count_for(current_user) %>
                      </span>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        <% else %>
          <div class="p-8 text-center">
            <div class="text-4xl mb-4">ðŸ’¬</div>
            <h3 class="text-lg font-bold text-white mb-2">No messages yet</h3>
            <p class="text-gray-400 mb-4">Start a conversation with a creator!</p>
            <%= link_to dashboard_path, class: "inline-flex items-center px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold rounded-full" do %>
              Browse Creators
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
    
    <!-- Chat Area (Empty state for index) -->
    <div class="hidden md:flex flex-1 items-center justify-center card-bg">
      <div class="text-center">
        <div class="text-6xl mb-4">ðŸ’¬</div>
        <h2 class="text-xl font-bold text-white mb-2">Select a conversation</h2>
        <p class="text-gray-400">Choose from your existing conversations or start a new one</p>
      </div>
    </div>
    
  </div>
</div>

<!-- User menu is handled globally by turbo_cleanup.js -->

